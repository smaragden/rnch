---
title: "Arnold Changelog v5.0.1.2"
date: 2017-09-25T22:28:37.323537+00:00
---

<div id="main">

<div class="milestone" id="content">
<h1>Milestone 5.0.1</h1>


<div class="description trac-content">
<h2 id="Enhancements">Enhancements</h2>
<ul><li><strong>Improved mesh light sampling</strong>: A new sampling algorithm has been implemented for mesh lights which can greatly improve their rendering quality when shading points near the light's surface, particularly in volumes. (#6005, #6062, #6074)
</li><li><strong>Indirect sample clamp</strong>: The new <code>options.indirect_sample_clamp</code> parameter works similar to the existing <code>AA_sample_clamp</code>, but only affects indirect light, so that specular highlights from direct lighting are preserved. This makes it possible to clamp fireflies more aggressively without affecting the final render significantly. It is set to 10.0 by default. Lower values result in more aggressive noise reduction, possibly at the expense of dynamic range. (#5978)
</li><li><strong>Sharper quad and disk light spread</strong>: Due to a more mathematically robust implementation, quad and disk lights now allow for more focused beams when their <code>spread</code> parameter is at zero. (#5980)
</li><li><strong>Faster BVH builds</strong>: The BVH ray accel data structures are now faster to build, specially on machines with many cores.  On a dual-socket 56-thread machine we've seen up to 2x faster builds and on a quad-socket 64-thread machine it's up to 3x faster. (#3474, #5951, #5962, #6001)
</li><li><strong>Polymesh as volume container</strong>: The <code>polymesh</code> node now can be a volume container when <code>step_size</code> is greater than zero, and in that mode it will interpret the assigned shader as a volume shader.  This is similar to other volume containers like sphere and box.  A built-in channel named &quot;density&quot; is provided for shaders to query, which will be 1.0 on the inside of the polymesh, and 0.0 outside.  To facilitate positional displacement in the volume shader, which is commonly used to add detail such as noise, there is an additional parameter <code>volume_padding</code> that will provide extra room.  Note that large volume padding values, particularly when combined with high polygon counts (including through subdivision) will hurt performance, so only use the amount of subdivision and padding you need. (#6039, #6057, #6059, #6060)
</li><li><strong>Padding in volume-capable primitives</strong>: In addition to the <code>polymesh</code> node, now <code>points</code>, <code>box</code> and <code>sphere</code> when in volume mode can have <code>volume_padding</code> applied so that positional displacement can be added in the volume shader. (#6055, #6059)
</li><li><strong>Iridescence in <code>standard_surface</code></strong>: Iridescence effects can be controlled by the new parameters <code>thin_film_thickness</code> and <code>thin_film_IOR</code> in the <code>standard_surface</code> shader, affecting the specular, transmission and coat components. This uses a new per-microfacet Airy formula, supports artistic Fresnel or complex IOR, and gives much more accurate results than the older <code>thin_film</code> shader. Typical thickness values are in the 0nm to 2000nm range. The effect will disappear above 3000nm. (#5750)
</li><li><strong>Exact Fresnel equation</strong>: The exact Fresnel equation is now used for both microfacet BRDF and microfacet refraction BSDF instead of Schlick's approximation. (#5371)
</li><li><strong>Coat AOV</strong>: New built-in AOVs were added for the <code>standard_surface</code> shader: <code>coat</code>, <code>coat_direct</code>, <code>coat_indirect</code> and <code>coat_albedo</code> AOVs. The builtin <code>specular</code> AOVs now only contain the base specular layer. (#6014)
</li><li><strong>Skydome Light AOV</strong>: The skydome light is now output to direct light AOVs by default again as in Arnold 4. It can still be output to the indirect light AOV by enabling the <code>skydome_light.aov_indirect</code> parameter. (#6022)
</li><li><strong>Global AOV shaders</strong>: A new list of shaders can be defined in <code>options.aov_shaders</code> that will be evaluated after the regular surface shader. With this it's possible to add shaders to set specific AOVs without modifying the original shader tree. Shaders intended for this purpose should add a boolean metadata named <code>aov_shader</code> on the node itself, as a user-interface hint. If <code>options.atmosphere</code> or <code>options.background</code> are set, these global AOV shaders will also be run for atmosphere and background contexts. (#5942)
</li><li><strong>Normal map shader</strong>: A <code>strength</code> parameter was added to increase or decrease the effect of the <code>normal_map</code> shader, with the default 1.0 applying the normal map unmodified. The <code>normalize</code> parameter was removed and the output normal is now always normalized. (#5971)
</li><li><strong>Camera barrel distortion</strong>: A new <code>persp_camera.radial_distortion</code> attribute has been added to specify the camera's quadratic radial distortion, with negative and positive values resulting in pincushion and barrel distortion respectively. (#2385)
</li><li><strong>Camera FOV EXR metadata</strong>: As a convenience, a new field <code>CameraFov</code> has been added to EXR metadata to explicitly store the render camera's FOV. This is a lot easier than having to derive it from the film aperture and focal length with the formula <code>fov = 2 * Rad_To_Deg * atan(CameraFilmApertureHorizontal / (2*CameraFocalLength))</code>. (#6026)
</li><li><strong>Half-float EXR layers</strong>: Output layers in files that support layers (such as regular or deep EXR files) can be individually set to type <code>HALF</code> by adding an optional <code>HALF</code> modifier to the corresponding output string. For instance: &quot;my_aov RGB filter driver HALF&quot;. (#3839)
</li><li><strong>Custom EXR layer names:</strong> Output layer names can be customized in file formats that support layers (regular or deep EXR) by adding an optional custom layer name after the driver name in the <code>options.outputs</code> string: (#6047)
<pre class="wiki"><code>outputs 2 1 STRING
 &quot;RGBA RGBA gaussian_filter driver_exr beauty&quot;
 &quot;RGBA RGBA variance_filter driver_exr beauty_variance&quot;
</code></pre></li><li><strong>OCIO display / view</strong>: OCIO Display/View tuples can now be selected as an output color space following Maya's convention. This applies to any input or driver node with a <code>color_space</code> string attribute. When using the OCIO color manager, if a color space name matches the format &quot;VIEW_NAME (DISPLAY_NAME)&quot; the given view on the given display will be used if they both exist. Note that conversions to a given display/view might not be valid for input textures, but they will always be available for output drivers. (#6069)
</li><li><strong>Weighted variance filter</strong>: The variance filter has a new <code>variance_filter.filter_weights</code> to set the weights used for each sample. The default value (<code>box</code>) matches the previous behavior. (#5954)
</li><li><strong>Array setting with <code>kick</code></strong>: Array parameters of type <code>float</code> can now be set in the command line with <code>kick -set</code>. For example, <code>kick -set mynode.myarray 0.1 0.2 0.3 0.4</code> will create and assign a 4-valued array to <code>myarray</code>. (#6043)
</li><li><strong>Upgraded OIIO to 1.7.15</strong>: We have upgraded to OIIO 1.7.15 which provides for several bug fixes and enhancements.  Improvements not listed in our bug fixes section are (#6009):
<ul><li>PSD files now have support for cmyk, multichannel, and grayscale color modes and now supports 32 bit per sample bit depths.
</li><li>Log statistics no longer list as &quot;BROKEN&quot; files which were invalidated or that were initialized but never actually opened.
</li></ul></li><li><strong>Upgraded OSL to 1.9.0</strong>: Open Shading Language has been upgraded to the latest version. This brings many performance improvements and bugfixes, along with new features such as operator overloading, struct initializers, and new utility functions. (#6034)
</li></ul><h2 id="APIadditions">API additions</h2>
<ul><li><strong>ASS file metadata</strong>: New API functions are provided to store and read metadata from .ass scene files. Metadata is added as special comments at the beginning of the file. For now, all metadata types are stored and read as strings. (#3833)
</li><li><strong>Non-destructive <code>AiASSWrite()</code></strong>: It is no longer necessary to enable <code>options.preserve_scene_data</code> before writing a scene to an .ass file in order to be able to render it or write it again afterwards. (#3182)
</li><li><strong><code>AiMakeTx</code></strong>: <code>AiMakeTx()</code> can now be run with an OCIO config, even outside an <code>AiBegin()</code> / <code>AiEnd()</code> block. Just specify <code>--colorconfig &lt;path_to_ocio_config&gt;</code> as an additional flag. All concurrent jobs must use the same config and convert to the same linear rendering color space. (#5786)
</li><li><strong><code>AiShaderGlobalsGetShader()</code></strong>: Return root shader node assigned to the object at the current shading point. (#5956)
</li><li><strong><code>AiShaderGlobals()</code></strong>: This function now allocates a more complete shader globals, so that when used with <code>AiTraceProbe()</code> user data is accessible. (#5956).
</li><li><strong><code>AtHPoint</code> C++ math operators</strong>: In addition to <code>AiV4Add()</code>, and associated math functions, operators +, -, *, and negation have been added in order to allow for cleaner code.  A <code>project()</code> member function has also been added which can be used instead of <code>AiV4Project()</code>.  The <code>AiV4CreateVector()</code> and <code>AiV4CreatePoint()</code> functions have now been overloaded so that the following is also possible:<br/>
<code>AtHPoint hp = AiV4CreatePoint(my_AtVector);</code> (#5918)
</li><li><strong><code>AiMicrofacetSetThinFilm()</code></strong>: This can be used to add thin film effects to the microfacet, metal and refraction BSDFs. It works by replacing the classic Fresnel term with a new Airy reflectance term, giving more accurate results than the <code>thin_film</code> shader. The microfacet normal is used instead of <code>sg-&gt;N</code>. (#5750)
</li><li><strong> <code>AiVolumeMergeIntersection()</code></strong>: Like <code>AiVolumeAddIntersection()</code>, this is used by a volume or implicit plugin to submit a ray interval for integration or intersection.  However, it will merge with other extents submitted that match, so that any overlapping intervals are not integrated and shaded more than once.  Previously a plugin would have to do this merging itself. (#6058)
</li></ul><h2 id="Incompatiblechanges">Incompatible changes</h2>
<ul><li><strong>Indirect sample clamp</strong>: This feature is enabled by default (at 10) and in most scenes will have little impact besides reducing noise. For fully backwards compatible renders this parameter may be set to a very high value like 1e30. (#5978)
</li><li><strong>Exact Fresnel equation</strong>: Due to the change of the Fresnel term, there will be differences especially when the relative IOR is close to 1, for example, when light travels from water to ice. (#5371)
</li><li><strong>OSL texture color space</strong>: By default no automatic color space conversion is applied anymore in <code>texture()</code> calls. To revert to the previous behavior, use the optional <code>colorspace</code> argument set to <code>auto</code>: <code>texture(&quot;filename.jpg&quot;, u, v, &quot;colorspace&quot;, &quot;auto&quot;)</code>. (#6030)
</li><li><strong><code>bounds_slack</code> renamed to <code>volume_padding</code></strong>: In volume nodes (those backed by plugins, such as the built-in OpenVDB volume node) the <code>bounds_slack</code> parameter has been renamed to <code>volume_padding</code> to be consistent with the other nodes.  A synonym exists for <code>bounds_slack</code> so it will continue to work, but will emit a warning when used to remind you to switch to the new parameter name. (#6059)
</li><li><strong><code>max_subdivisions</code></strong>: The type of the global <code>options.max_subdivisions</code> has been changed from <code>AI_TYPE_INT</code> to <code>AI_TYPE_BYTE</code>, to match the type of <code>polymesh.subdiv_iterations</code>. Existing client code should set this global option with <code>AiNodeSetByte()</code> to avoid a (harmless) warning. (#6029)
</li><li><strong><code>light_decay</code> output type changed</strong>: The shader output type of the <code>light_decay</code> light filter shader changed from <code>AI_TYPE_FLOAT</code> to <code>AI_TYPE_NONE</code>.  It doesn't actually output anything, it just modifies the shader globals as do the other light filters.  This makes its output type consistent with the other light filter shaders.  Any shader networks that were relying on its output should be disconnected from it. (#6076)
</li><li><strong>OCIO config defaults:</strong> For well known OCIO configs Arnold will use a name-based heuristic to determine reasonable default color spaces and chromaticities. These new defaults will be reported in the log file. This applies to ACES, nuke-default, spi and filmic-blender configs. Previously <code>Rec. 709</code> chromaticities were always assumed. (#6035)
</li></ul><h2 id="Bugfixes">Bug fixes</h2>
<h3 id="a5.0.1.0">5.0.1.0</h3>
<p>
</p><div><dl class="wiki compact"><dt style="font-weight: bold; float:left; padding-right:.5em">#5927</dt><dd>Memory pools allocations are much bigger than requested</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5639</dt><dd>Mesh lights in procedurals not working properly</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5839</dt><dd>Metadata files don't allow boolean values as attribute or metadata name</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5870</dt><dd>skydome_light and quad_light incorrectly detect some textures as constant color</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5880</dt><dd>camera_projection : use NODE instead of STRING</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5910</dt><dd>Missing Python bindings for some AtNodeEntry API functions</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5911</dt><dd>Nodes contained in .obj and .ply procedurals are registered in the global name scope</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5917</dt><dd>Remove pykick since it's broken</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5923</dt><dd>UINT parameter values are clamped to 0x7FFFFFFF when parsed from .ass files</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5925</dt><dd>Properly handle cases where cpuset is smaller than the detected number of cores</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5926</dt><dd>ignore_motion_blur with non-zero reference_time does not work with a polymesh with normals</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5930</dt><dd>normal_map shader issues</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5931</dt><dd>Standard surface coat normal not decoupled from main normal</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5936</dt><dd>AiNodeClone not working for parameter overrides</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5940</dt><dd>AiNodeEntryGetDerivedType wrong for builtin procedural and implicit nodes</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5946</dt><dd>Inconsistent reference_time between deform and transform motion blur</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5947</dt><dd>AiSetAppString() not working</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5950</dt><dd>Improve precision of box and plane objects</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5953</dt><dd>Wrong stats after destroying shape nodes</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5964</dt><dd>LPEs not working with raw drivers</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5969</dt><dd>Avoid gcc -Wall warning about strict-aliasing in AtParamValue</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5973</dt><dd>Curves with varying UVs rendering wrong</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5977</dt><dd>Shadow matte shader missing transparency with passthrough shader</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5982</dt><dd>Memory leak due to AiShaderEvalParamArray</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5988</dt><dd>Avoid gcc -Wall warning about strict-aliasing in AtArray</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5991</dt><dd>OpenEXR metadata not working for 3D vectors and RGB colors</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5992</dt><dd>Color Manager: support chromaticities for additional standard gamuts / white points</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5994</dt><dd>Color manager: wrong chromaticities for XYZ rendering color space</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#6001</dt><dd>Performance regression in BVH build</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#6015</dt><dd>Crash with oriented curves mode when no orientations are specified</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#6028</dt><dd>Rendering color space: use more accurate conversion matrix</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#6029</dt><dd>tighten max_subdivisions from 999 to 255</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#6030</dt><dd>Set OSL texture() default color transform to no-op</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#6031</dt><dd>OSL refraction closure crash</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#6036</dt><dd>Missing nodes not aborting render</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#6041</dt><dd>Color Manager: account for white reference when chromaticities are specified</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#6044</dt><dd>Color Manager: test and warn for degenerate rendering color space chromaticities</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#6045</dt><dd>Color management: review warning and error severity</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#6049</dt><dd>AtTextureHandle becomes corrupt after invalidating corresponding opacity texture</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#6053</dt><dd>AiNoise*() returns black when number of octaves is large</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#6076</dt><dd>Change light_decay output type to AI_TYPE_NONE</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5899</dt><dd>Missing linkable metadata for some shader parameters</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#6080</dt><dd>trace() in OSL doesn't give the closest hit point</dd></dl></div><p>
</p>
<h3 id="a5.0.1.1">5.0.1.1</h3>
<p>
</p><div><dl class="wiki compact"><dt style="font-weight: bold; float:left; padding-right:.5em">#5981</dt><dd>Incorrect melanin absorption values for wide gamut rendering color spaces</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#6089</dt><dd>Deep EXR output of light path expressions missing volumes</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#6094</dt><dd>artifacts in latlong skydome_light</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#6095</dt><dd>Fresnel discontinuity in diffuse term when texture is connected to specular_color</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#6097</dt><dd>Subdiv: duplicate vertex index in face causes crash</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#6116</dt><dd>Warn that images will be watermarked if license authorization fails</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#6124</dt><dd>mesh_light crashing when provided non-mesh node</dd></dl></div><p>
</p>
<h3 id="a5.0.1.2">5.0.1.2</h3>
<p>
</p><div><dl class="wiki compact"><dt style="font-weight: bold; float:left; padding-right:.5em">#6128</dt><dd style="color:red">curvature shading differences when seen through glossy transmission/reflection</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#6135</dt><dd style="color:red">crash during accel construction if there are over 65k overlapping primitives</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#6143</dt><dd style="color:red">AiShaderGlobalsGetVertexUVs not working for uvsets in free render mode</dd></dl></div><p>
</p>
</div>

</div>
</div>