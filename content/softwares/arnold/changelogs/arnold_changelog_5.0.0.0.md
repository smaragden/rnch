---
title: "Arnold Changelog v5.0.0.0"
date: 2017-09-25T22:28:37.412260+00:00
---

<div id="main">

<div class="milestone" id="content">
<h1>Milestone 5.0</h1>


<div class="description trac-content">
<h2 id="Enhancements">Enhancements</h2>
<h3 id="Shaders">Shaders</h3>
<ul><li><strong>Standard Surface</strong>: a new <code>standard_surface</code> shader was added, with intuitive and energy conserving parameters, a secondary specular coat with separate normal, metallic Fresnel, thin surface support and more. The <code>standard</code> shader is still available but considered deprecated. (#5372)
</li><li><strong>Standard Hair</strong>: a new physically based <code>standard_hair</code> shader was added, with much more accurate specular and transmissive scattering, better diffuse scattering for dirty hair, melanin randomization, and simple and intuitive parameters. The older <code>hair</code> shader is still available but considered deprecated. (#5370, #5851)
</li><li><strong>Standard Volume</strong>: a new <code>standard_volume</code> shader was added, usable for rendering a wide variety of volumes. The shader provides independent control of density, scattering color and transparency, in a way that is energy conserving by default. Fire can be rendered using blackbody emission driven by temperature. Displacement can be used to add more detail to volumes. This supersedes the <code>density</code> volume shader, which has been removed. (#5090)
</li><li><strong>Shader mixing</strong>: surface, hair and volume shaders now output closures rather than colors. This makes it possible to mix shaders efficiently, using the new <code>mix_shader</code> node to blend or add two shaders including all their light AOVs.  Adopted from the common shaders, there is also a vanilla color mixing shader <code>mix_rgba</code>. The ray switch shader has been split up into two <code>ray_switch_shader</code> and <code>ray_switch_rgba</code> nodes, for switching between shaders and one for switching between texture colors respectively. (#5494, #5495)
</li><li><strong>Bump shaders</strong>: <code>bump2d</code> and <code>bump3d</code> now output a normal vector that can be linked to new <code>normal</code> parameters in <code>ambocc</code>, <code>lambert</code>, <code>standard_surface</code> and <code>utility</code> shaders. These bump shaders no longer function as passthrough shaders. The <code>@before</code> syntax for bump shaders has been removed as well. (#5599)
</li><li><strong>Noise shader</strong>: The <code>noise.coord_space</code> parameter now has a <code>uv</code> enum value for texturing using the object’s local UV coordinates. Note that this calls the faster 2D noise API, not the 3D noise like all other coordinate spaces. In addition, an arbitrary coordinate space can be specified manually by linking another shader into the new <code>P</code> parameter. The shader can now output colors, in <code>scalar</code> mode by blending between <code>color1</code> and <code>color2</code>, and in <code>vector</code> mode with a separate noise signal per color channel. A new <code>time</code> parameter can be used to smoothly vary noise over time. (#5195, #5235, #5247)
</li><li><strong>Utility shader</strong>: the <code>utility</code> shader has been enhanced with a new <code>metal</code> shading mode, and a <code>roughness</code> control has been added that affects plastic and metal modes. (#5018)
</li><li><strong>Legacy standard shader</strong>: the Beckmann specular distribution in the (deprecated) <code>standard</code> shader now uses more correct per-microfacet fresnel, as was already used for GGX. <code>sss_profile</code> has been removed and the empirical BSSRDF is now always used. (#3285)
</li><li><strong>Legacy hair shader</strong>: <code>uparam</code> and <code>vparam</code> have been removed from the (deprecated) <code>hair</code> shader. Instead, curves now support UV sets. This shader does not fully support light path expressions. (#5646)
</li><li><strong>Env vars in <code>image</code> filename</strong>: the <code>image</code> node filename field will now expand environment variables of the form <code>[var]</code>, in addition to it already expanding them when they are in the texture searchpath. (#5671)
</li><li><strong>New tags in <code>image</code> filename</strong>: the <code>image</code> node filename field now accepts <code>&lt;utile&gt;</code> and <code>&lt;vtile&gt;</code> tags.  They take an optional integer offset <code>&lt;utile:2&gt;</code> that adds to the tile number; e.g. an offset of 2 from a U coordinate of 1.4 will output tile number 3. (#5753)
</li><li><strong>Renamed <code>image</code> missing tile parameters</strong>: on the <code>image</code> texturing node, <code>ignore_missing_tiles</code> has been renamed to <code>ignore_missing_textures</code>, and <code>missing_tile_color</code> has been renamed to <code>missing_texture_color</code>.  The handling of missing textures has been extended to non-tagged textures.  It is still recommended to not ignore missing textures and fix them (the render will emit an error to the log and abort if <code>options.abort_on_error</code> is left on). However in some cases missing UDIM or other tiled textures may be a deliberate choice.  These options allow control, per image node, what happens in those cases. (#5753)
</li><li><strong>Built-in utility common shaders</strong>: The common utility shaders that shipped at least in part with MtoA, C4DtoA, HtoA and KtoA have been integrated into the core.  A few shaders from the set have not been added, such as <code>print</code>, <code>linearize</code>, <code>ln</code> and the matrix shaders, and a few have improved parameter defaults, and others have been optimized, but they are largely the same. (#5714, #5749)
</li><li><strong>Color Jittering shader</strong>: a new <code>color_jitter</code> shader can be used to generate random colors within a specified gain, hue and saturation range. Colors may be randomized per face, object, procedural instance or user data, or a combination. (#5793)
</li><li><strong>Triplanar Shader</strong>: a new <code>triplanar</code> shader can be used to quickly map image textures without needing UV coordinates. The texture is projected onto the object from the 6 sides, and smoothly blended together at the seams. (#5770)
</li><li><strong>Dedicated normal and vector map shaders</strong>: The common shader <code>space_transform</code> had extra functionality for dealing with tangent-space normal or vector maps, and that has been removed.  Instead, there are now two new shaders, <code>normal_map</code> and <code>vector_map</code> that take typical normal map and vector displacement map data, respectively, and prep them for their typical use later in a shading network, similar to how the bump shaders would be used. (#5714)
</li><li><strong><code>osl</code> shader</strong>: while it is recommended to compile .osl files to .oso and place them in the shader path, OSL shader code can be referred to directly via the <code>osl</code> node or even set as a string parameter.  The shader node will then generate all the parameters of the OSL code with the <code>param_</code> prefix in front of each. (#5471)
</li><li><strong>Skydome light camera visibility</strong>: New <code>camera</code> and <code>transmission</code> parameters set the amount of light contributed to camera and specular transmission rays, so that it is no longer required to use a separate background shader for such purposes. A new <code>shader</code> parameter may be used to link closure shaders to control color and transparency. Skydome lights are now preferred over background shaders, as they provide the same functionality with better sampling. (#5744)
</li></ul><h3 id="Sampling">Sampling</h3>
<ul><li><strong>Dithered sampling</strong>: most samplers (e.g. soft shadows, indirect illumination, depth of field) will now take advantage of dithered sampling, which improves the visual distribution of noise specially at low sample rates. (#5047, #5412)
</li><li><strong>Quad lights</strong>: sampling has been improved, reducing noise for surface lighting. For comparisons with the previous sampler, <code>options.enable_new_quad_light_sampler</code> can be disabled. (#4961, #5780)
</li><li><strong>Cylinder lights</strong>: sampling has been improved, significantly reducing noise for cylinder lights in volumes or where cylinder lights are located near other surfaces. (#5347)
</li><li><strong>Disk lights</strong>: a novel sampling algorithm has been implemented for disk lights which can greatly improve their rendering quality when shading points near the disk's surface, particularly in volumes. (#5316, #5856, #5862)
</li><li><strong>Russian roulette</strong>: on average better performance for hair, transmission and volume scattering. (#4052, #5789, #5690)
</li><li><strong>Motion blur time samples</strong>: rendering motion blur is now faster when using non-default <code>deform_time_samples</code> or <code>transform_time_samples</code>. (#5336)
</li><li><strong>Caustic noise reduction</strong>: a new method was added to reduce noise from caustics. Noise from GGX microfacet speculars in particular is reduced. <code>options.indirect_specular_blur</code> controls the trade-off between more accurate noisy renders at 0.0, and more blurry biased renders with reduced noise at higher values. (#4498)
</li><li><strong>Faster opacity mapping</strong>: opacity-mapped transparent surfaces, such as tree leaves, are now sampled more efficiently and can render up to 20% faster, specially in machines with many threads. (#4704)
</li></ul><h3 id="OSLClosuresandAOVs">OSL, Closures and AOVs</h3>
<ul><li><strong>Open Shading Language</strong>: shaders can now be written in Open Shading Language, an advanced shading language for production GI renderers. OSL shaders placed in the shader search path are automatically registered as Arnold shader nodes, with their parameters converted to Arnold parameters. Once loaded, they can be inspected, instantiated and linked in exactly the same way as C++ shaders. OSL shaders can be used to implement texture patterns and materials using closures. See the <a class="ext-link" href="https://support.solidangle.com/display/ARP/OSL+Shaders"><span class="icon">​</span>Arnold OSL documentation</a> for more details. (#4357, #5400, #5487, #5526, #5471)
</li><li><strong>Closures</strong>: a new closure parameter type has been added, which shaders can output instead of final colors. There are BSDF, BSSRDF, emission, matte, transparency and volume closures. See the API documentation and <a class="ext-link" href="https://support.solidangle.com/display/ARP/Closures"><span class="icon">​</span>examples</a> for more details on how to use these. Linking a color to a closure parameter will automatically create an emission closure with that color. A closure parameter however can't be linked or converted to a color, as the integrator only computes lighting after shader evaluation. (#4793)
</li><li><strong>Light group AOVs</strong>: surface shaders now natively support light group AOVs, previously this feature was only available for volume shading. (#4305)
</li><li><strong>Light path expressions</strong>: light path expressions are used to write lighting components into separate AOVs. No longer should individual shaders define AOVs for direct/indirect light and various layers, rather a regular expression syntax is used to define the subset of all scattering and emission events in the scene that should be written to each AOV. Built-in AOVs are available for the common cases. See the <a class="ext-link" href="https://support.solidangle.com/display/ARP/Light+Path+Expression+AOVs"><span class="icon">​</span>LPE documentation</a> for details. (#5491, #5581, #5582)
</li></ul><h3 id="ColorManagement">Color Management</h3>
<ul><li><strong>Color Managers</strong>: custom <code>color_manager</code> nodes can now be implemented to handle input and output color transforms. A color manager is a package similar to SynColor or OpenColorIO. If no color manager is specified in <code>options.color_manager</code>, Arnold will use the built-in one which supports <code>linear</code> (no transform), <code>sRGB</code> and <code>Rec709</code> (non linear) (#5262, #5527)
</li><li><strong>OpenColorIO</strong>: color spaces defined in OpenColorIO configurations can now be used in .ass files through the built-in <code>color_manager_ocio</code> node. (#5598)
</li><li><strong>Linear color spaces</strong>: any linear color space can now be specified through the color manager for any output driver that supports halfs or floats. (#5552)
</li><li><strong>Color space metadata</strong>: OpenEXR files have additional metadata fields with color manager type (<code>arnold/color_manager</code>), color space name (<code>arnold/color_space</code>) and chromaticities (<code>ColorSpace/Red Primary</code>, etc) when known. (#5263)
</li><li><strong>Rendering color space</strong>: using specific implementations of a color manager it is now possible to specify Arnold's rendering color space. Arnold's default rendering color space is <code>Linear sRGB</code>. For other color spaces Arnold will try to auto-detect chromaticities and illuminant, and will expect all data (textures and .ass file parameters) in that same color space. An important note is that different rendering color spaces will yield different render results when compared with the default <code>sRGB linear</code>. These color and intensity shifts will be more visible with transmission, but will also affect illumination and subsurface. Because of this, shader adjustments and texturing should happen in the same color space as the rendering one. (#5262, #5527, #5819)
</li><li><strong>Color space-independent spectral effects</strong>: effects that perform spectral integration, like refractive dispersion, <code>thin_film</code>, <code>blackbody</code> and <code>physical_sky</code> now take into account the rendering color space and provide accurate results for wider gamut spaces, or spaces with different illuminants. There might be some differences for these effects, like higher saturation, due to improved color computations. (#5819, #5835, #5836, #5837)
</li><li><strong>Listing available color spaces</strong>: <code>kick -lcs</code> prints a list of available color spaces. (#5832)
</li></ul><h3 id="Namespaces">Namespaces</h3>
<ul><li><strong>Namespaces</strong>: Arnold scenes are organized in hierarchies of procedurals, which previously could lead to naming conflicts when identically names nodes existed in different procedurals. Each procedural now has its own naming scope, with the following rules: (#2712)
<ul><li>In procedurals .ass files, node names are looked up first in the current scope. If not found, they are looked up in the parent scopes until the scene root is reached.
</li><li>Alternatively, an absolute path may be specified to look up a node starting from the scene root, for example: <code>&quot;^root_node^proc1^proc2^node_name&quot;</code>.
</li><li><code>AiNodeLookUpByName()</code> now has a <code>parent</code> parameter to specify the scope where recursive lookup begins.
</li><li>Procedural plugins creating nodes using <code>AiNode()</code> and <code>AiNodeClone()</code> must now set the <code>parent</code>parameter, to indicate that the node is a child of the current procedural node.
</li></ul></li><li><strong>Procedural Node Overrides</strong>: nodes inside a <code>procedural</code> can be replaced by other nodes with the <code>override_nodes</code> parameter. This may be used for example to replace shaders in an existing .ass procedural. When the parameter is enabled, nodes in the immediate parent scope of the procedural will replace identically named nodes inside the procedural. (#2712)
</li></ul><h3 id="OtherEnhancements">Other Enhancements</h3>
<ul><li><strong>OpenVDB</strong>: rendering of .vdb files is now supported in the Arnold core, using OpenVDB 4.0. The <code>volume</code> node now has a <code>filename</code> parameter that accepts .vdb files. The <code>volume_implicit</code> node may be used to render OpenVDB volumes as an implicit surface. The parameters for both nodes are the same as in the previous OpenVDB plugin, except for the velocity shutter start and end which has been replaced by <code>motion_start</code> and <code>motion_end</code> parameters shared with other shapes. Velocity grids named <code>v</code>, <code>vel</code> or <code>velocity</code> are automatically detected and used if motion blur is enabled in the scene. <code>options.texture_searchpath</code> is used to resolve relative filepaths. (#4844, #5801, #5814)
</li><li><strong>Improved OpenVDB startup time</strong>: On Linux when rendering with many threads, large OpenVDB datasets could cause significant slowdowns at the start of rendering.  Startup times are noticeably improved, resulting in buckets rendering faster especially for low AA samples such as during IPR. (#5816)
</li><li><strong>Faster implicit surfaces</strong>: Implicit surfaces, through the <code>implicit</code> geometric primitive, render faster, particularly when using the uniform solver.  The uniform solver requires fewer solver samples to accomplish much-improved quality, and the levelset solver got slightly faster as well. (#3221, #5472, #2097)
</li><li><strong>Faster curves</strong>: The <code>curves</code> geometric primitive now renders about 5 to 15% faster. In addition, when rendering dense hair clumps, <code>min_pixel_width</code> is now up to 2x faster and results in more accurate shadowing, at the expense of a slight increase in sampling noise. (#4417, #5725, #5806, #5684, #5806)
</li><li><strong>Faster object initialization</strong>: The initialization time for motion blurred objects is now about 700ns faster.  For a scene with 1M motion blurred objects, that's a savings of about 0.7s. (#5379)
</li><li><strong>VR camera</strong>: a new <code>vr_camera</code> node is now available that generates stereo views suitable for virtual reality in a variety of formats and projections. (#4906)
</li><li><strong>Quad and spot light roundness</strong>: Quad and spot lights now have a <code>roundness</code> parameter, going from a square shape at 0, to rounded corners, to a disk shape at 1. Quad lights also have a new <code>soft_edge</code> parameter to soften the edges, similar to the <code>penumbra_angle</code> for spot lights. (#5144, #5222)
</li><li><strong>Lazy evaluation of shader array linking</strong>: When calling <code>AiShaderEvalParamArray()</code>, no shaders are evaluated anymore. Reading one of the array values later on will trigger the corresponding shader evaluation, and the result is cached to avoid multiple shader evaluations. This means performance no longer depends on the number of links, which can be scaled as necessary. (#2924)
</li><li><strong>RGB camera filter maps</strong>: The data type of camera filter maps has changed from float to <code>AtRGB</code> so that colored effects are possible. (#5299)
</li><li><strong>Object <code>transform_type</code></strong>: Shape objects (<code>ginstance</code>, <code>polymesh</code>, etc.) now have a <code>transform_type</code> parameter that specifies what type of motion the object has.  Options are <code>linear</code>, <code>rotate_about_center</code>, and <code>rotate_about_origin</code>. <code>linear</code> corresponds to the linear interpolation between matrices that Arnold 4.2 used to do when <code>options.curved_motionblur=false</code>.  <code>rotate_about_origin</code> corresponds to <code>curved_motionblur=true</code>.  Unlike <code>rotate_about_origin</code>, which sets the rotation pivot at the origin, <code>rotate_about_center</code> will rotate about the object's center.  This is the default mode and is useful for wheels, propellers, and other objects which spin. (#3962, #5376)
</li><li><strong>Hair UVs</strong>: <code>curves.uvs</code> is a new parameter to set <code>sg-&gt;u</code> and <code>sg-&gt;v</code> default texture coordinates, similar to polymeshes. UVs may be specified per curve or per point, with an array that has the same length as uniform and varying user data respectively. <code>sg-&gt;bu</code> and <code>sg-&gt;bv</code> still contain the UV coordinates along the width and length of the curve respectively. The <code>hair</code> parameters <code>uparam</code> and <code>vparam</code> have been removed, as they can now be set through <code>curves.uvs</code>. (#5646)
</li><li><strong><code>ARNOLD_PLUGIN_PATH</code></strong>: This environment variable is now used automatically in <code>AiBegin()</code> to load plugins, and to find procedural and volume DSOs. Previously this was a convention used by <code>kick</code> and the DCC plugins. (#5282)
</li><li><strong><code>kick</code> camera controls</strong>: New command-line flags to tweak the current render camera have been added. You can now set the position (<code>-position</code>), up vector (<code>-up</code>) and look at point (<code>-lookat</code>) for the current camera. This means that <code>kick -turn</code> now works for cameras defined with a matrix if you use the <code>-lookat</code> flag. (#5311)
</li><li><strong><code>kick</code> exposure keys</strong>: The <code>[</code> and <code>]</code> keys can be used to decrease or increase exposure in <code>kick</code> when in <code>-ipr</code> mode. (#5380)
</li><li><strong><code>kick</code> abort on error</strong>: <code>kick</code> now aborts on errors during loading of .ass files by default, to avoid rendering when plugins are missing or files are corrupted. Previously it would only abort on errors during rendering. Aborting can still be disabled with <code>-set options.abort_on_error off</code>. (#5736)
</li><li><strong>Polygon holes</strong>: a new attribute <code>polymesh.polygon_holes</code> is available to add holes to given faces of a mesh. For instance,
<pre class="wiki"><code>polymesh
{
 name quad_with_hole
 nsides 2 1 UINT 4 4
 polygon_holes 2 1 UINT 1 0
 ...
</code></pre>indicates that the face with index 1 will be a polygon hole on face 0. Multiple holes per face are supported. The winding of a face used as a hole does not need to be reversed. Also, note that polygonal holes are ignored when a mesh is subdivided. (#2972)
</li><li><strong>Tagging deprecated nodes</strong>: Nodes can be tagged as deprecated by adding boolean metadata named &quot;deprecated&quot; (with the parameter name empty) set to true. These nodes will be listed in <code>kick -nodes</code> with <code>[deprecated]</code>, and when they are instantiated in an Arnold scene they will issue a warning to remind the user. (#5746)
</li><li><strong>Updated to RLM 12.2BL2</strong>: We have upgraded the license server and the external library controlling the licensing subsystem from version 12.0BL2 to 12.2BL2, a more stable release fixing various crashes, bugs, hangs and memory leaks. (#5754)
</li><li><strong>Updated to OIIO 1.7.12</strong>: We have upgraded from OIIO 1.7.7 to OIIO 1.7.12. (#5672, #5826)
</li></ul><h2 id="Incompatiblechanges">Incompatible changes</h2>
<h3 id="Options">Options</h3>
<ul><li>Added <code>options.subdiv_dicing_camera</code>, replacing the per polymesh adaptive subdivision dicing camera with a global one. (#5029)
</li><li>Replaced <code>options.aspect_ratio</code> with <code>options.pixel_aspect_ratio</code>. The new pixel aspect ratio follows the usual definition <code>pixel_width / pixel_height</code>. Note that the new attribute is the inverse of the old <code>options.aspect_ratio</code>. (#5392)
</li><li>Renamed <code>options.shader_searchpath</code> to <code>options.plugin_searchpath</code>, all types of node plugins are loaded from this path. (#5779)
</li><li>Removed <code>enable_fast_opacity</code>, so that the fast opacity mode is always used. (#5158)
</li><li>Removed <code>auto_transparency_threshold</code>: The <code>options.auto_transparency_threshold</code> has been removed.  As long as shaders make sure to use <code>AiShaderGlobalsStochasticOpacity()</code>, there is no need for manually specifying a transparency threshold. (#4842)
</li><li>Removed <code>ignore_direct_lighting</code>: The AOV system provides various indirect lighting AOVs that can achieve the same result as this old debugging option. (#5029)
</li><li>Removed <code>options.curved_motionblur</code>, in favor of a per object <code>transform_type</code> parameter. (#5437)
</li><li>Removed <code>options.bump_space</code> and <code>options.bump_multiplier</code>. Bump mapping is now always in object space. (#5029)
</li><li>Removed <code>options.GI_fallof_start_dist</code> and <code>options.GI_fallof_stop_dist</code> have been removed. (#4793)
</li><li>Removed <code>options.light_gamma</code> and <code>options.shader_gamma</code>. All shader and light attributes are now assumed linear. The <code>always_linear</code> metadata is therefore no longer needed and is no longer supported. (#5245)
</li><li>Removed rarely used <code>bottom</code>, <code>right</code> and <code>woven</code> modes from the <code>options.bucket_scanning</code> enum. (#5642)
</li><li>Removed <code>options.enable_threaded_procedurals</code>, this was previously already enabled by default. We now require clients to make their geometry procedurals thread safe. (#5029)
</li><li>Removed <code>options.CCW_points</code>. If polygons have a clockwise winding order, they are now expected to be converted to counter-clockwise when translating the geometry. (#5029)
</li><li>Removed <code>options.shadows_obey_light_linking</code>, this is now off as was already the default. To have light groups affect shadows, set the shadow group to the same value as the light group. (#5029)
</li><li><code>options.preserve_scene_data</code> is no longer propagated when writing to an .ass file. (#5651)
</li><li>Removed <code>options.procedural_force_expand</code>, since procedurals are always expanded during initialization now. (#5612)
</li></ul><h3 id="Lights">Lights</h3>
<ul><li>Lights with <code>normalize off</code> and radius zero now no longer emit any light, for consistency with lights with very small radii. Previously these would work as if <code>normalize</code> was <code>on</code>. (#3851)
</li><li>Light sampling now uses <code>options.GI_diffuse_samples</code> and <code>options.GI_specular_samples</code> for multiple importance sampling. If existing scenes render with more noise, increasing these samples maybe be necessary. (#5423)
</li><li>Removed constant light decay, and the <code>decay_type</code> parameter, so that all lights now have quadratic decay. (#5147)
</li><li>Removed support for negative lights (negative <code>color</code>, <code>intensity</code>, or <code>shadow_color</code>).  Negative values will now be clamped to zero. (#5162)
</li><li>Removed <code>affect_diffuse</code>, <code>affect_specular</code> and <code>affect_volumetrics</code> parameters. Instead <code>diffuse</code>, <code>specular</code>, <code>sss</code> and <code>volume</code> multipliers can be set to zero. (#5423)
</li><li>Renamed <code>gobo</code> parameters <code>scale_s</code>, <code>scale_t</code>, <code>wrap_s</code>, <code>wrap_t</code> to <code>sscale</code>, <code>tscale</code>, <code>swrap</code> and <code>twrap</code>. (#5183)
</li></ul><h3 id="RayTypes">Ray Types</h3>
<ul><li>The ray types used for ray visibility, the ray switch shader, GI depth and samples have changed. There are now 5 scattering ray types: diffuse reflection, diffuse transmission (includes SSS), specular reflection, specular transmission and volume scattering. In the options node there is now a GI depth and number of samples for diffuse, specular and transmission rays. <code>kick</code> now has arguments to set the diffuse, specular and transmission depth and samples. (#3462, #5572)
</li></ul><h3 id="MotionBlur">Motion Blur</h3>
<ul><li>Arnold and its DCC plugins used to encourage the use of &quot;canonical&quot; 0..1 time for all data in .ass files and in Arnold.  For example, if motion blur samples went from frame-relative time of -0.25 to 0.25, in Arnold-land the -0.25 time sample would become 0.0 and the 0.25 time sample would become 1.0.  This simplified the data in .ass files, etc but made it difficult or impossible to share .ass standins among vendors or even shots that differed in their time ranges, and to know why the motion blur was mismatched.  Now, the <code>transform_time_samples</code> and <code>deform_time_samples</code> arrays, along with <code>time_samples</code> arrays on lights and cameras have all been removed in favor of the simpler <code>motion_start</code> and <code>motion_end</code> float parameters on each object.  These should always be frame-relative values, e.g. -0.25 and 0.25 respectively in the example above. <em>NOTE</em> that this means non-uniform motion time samples are no longer possible; if an object has N motion keys, the time interval will always be divided up into N-1 equally-space time intervals.  Also, this means that transform motion blur and deformation motion blur will always use the same time range. (#4916)
</li><li>Volume motion blur is also controlled by <code>motion_start</code> and <code>motion_end</code> parameters. The <code>velocity_fps</code> should be set to the framerate, so that the velocity can be scaled to the length of the frame. With the frame relative convention, motion start and end should typically default to -0.5 and 0.5 respectively, indicating the velocity was sampled at the center of the frame.  (#4844)
</li></ul><h3 id="OtherChanges">Other Changes</h3>
<ul><li><strong>Visual Studio 2015 redistributable</strong>: In Windows, we now require the VS 2015 redistributable to be installed in order to run Arnold. We expect most of our users to have it already, but if not the installer can be downloaded from the following link: <a class="ext-link" href="https://www.microsoft.com/en-us/download/details.aspx?id=48145"><span class="icon">​</span>https://www.microsoft.com/en-us/download/details.aspx?id=48145</a> (#4445)
</li><li><strong>Geometry ID</strong>: The type of geometry <code>id</code> attribute and of the associated built-in AOV has been changed from <code>INT</code> to <code>UINT</code>. (#5315)
</li><li><strong>AOV filtering</strong>: Built-in linear filters (<code>gaussian_filter</code>, etc) will no longer work on AOVs of type <code>INT</code>, <code>UINT</code> or <code>BOOL</code>. <code>closest_filter</code> should be used instead. (#5175)
</li><li><strong>Custom cameras</strong>: Custom cameras can now implement <code>camera_reverse_ray</code> to convert from camera space to raster space. This makes it possible for any custom camera to work as a dicing camera, support <code>min_pixel_width</code>, support accurate raster-space wireframe width, etc. (#4477)
</li><li><strong><code>procedural</code> node</strong>: The <code>procedural</code> node now only supports loading .ass, .obj, .ply files, and creating procedurals using methods provided through <code>funcptr</code>. The <code>dso</code> parameter has been renamed to <code>filename</code>. <code>options.procedural_searchpath</code> is now only used for this node. Procedural plugins instead register new node types now. (#5154)
</li><li><strong>Deferred procedurals</strong>: Removed support for deferred procedurals. All procedurals are now loaded during scene initialization (right before rendering). Also, <code>load_at_init</code>, <code>min</code> and <code>max</code> parameters have been removed. (#5612)  
</li><li><strong>Gamma options removed</strong>:
<ul><li>Output drivers now take a <code>color_space</code> string attribute to specify which color space to use for rendered images. Built-in values are <code>linear</code>, <code>sRGB</code> and <code>Rec709</code>. The default value <code>auto</code> will use <code>sRGB</code> for 8 bit formats and <code>linear</code> otherwise. All <code>driver_*.gamma</code> have been removed. (#5244)
</li><li><code>image</code> nodes now have an <code>color_space</code> attribute to specify which color space the texture is assumed to be in. Built-in values are <code>linear</code>, <code>sRGB</code> and <code>Rec709</code>. The default value <code>auto</code> will use <code>sRGB</code> for integer (8 or 16 bit) formats and <code>linear</code> otherwise. The attribute <code>options.texture_gamma</code> has been removed. (#5254)
</li><li>Legacy gamma related options in <code>kick</code> (-g/tg/sg/lg) have been removed. You can now set the output color space for a render with <code>kick -ocs &lt;string&gt;</code>. (#5267)
</li></ul></li><li><strong>Removed <code>-log</code> legacy option in <code>kick</code></strong>: Use the more explicit <code>-logfile &lt;path&gt;</code> instead. (#5783)
</li><li><strong>32-bit Integer TIFF</strong>: Removed the broken <code>int32</code> format from <code>driver_tiff</code>. Note that 32-bit integer TIFFs cannot be read by Nuke nor Gimp, and OSX Preview displays a reduced bit depth version, making this format pretty useless anyway. (#2976)
</li><li><strong>Removed <code>driver_display</code></strong>: The <code>driver_display</code> node, which was rarely used, has been removed. (#5270)
</li><li><strong>Removed legacy pixel filters</strong>: The following pixel filters, which were rarely used, have been removed: <code>catrom2d_filter</code>, <code>cook_filter</code>, <code>cone_filter</code>, <code>cubic_filter</code>, <code>disk_filter</code>, <code>video_filter</code>. (#5673)
</li><li><strong>Always use auto-bounds for volumes and implicits</strong>: Volume and implicit plugins already notify Arnold of the bounds around the data they provide.  Users could previously override this with <code>min</code> and <code>max</code> parameters, but those have been removed for volume nodes and are unused for implicit plugins.  All volume plugins will automatically have a <code>bounds_slack</code> parameter available to expand the natural bounding box around the data for purposes of adding positional noise in shaders, etc.  Volume plugins are responsible for increasing their reported bounds by the <code>bounds_slack</code> amount.  Also, the <code>load_at_init</code> parameter has been removed from both volume and implicit type nodes, as it had no effect in practice. (#5831)
</li></ul><h2 id="APIchanges">API changes</h2>
<h3 id="General">General</h3>
<ul><li>Many API functions now accept arguments by reference instead of by pointer. (#2159)
</li><li>Many API functions that used to have <code>char*</code> arguments or returns will now instead use <code>AtString</code>.  Some of these changes should be transparent on account of the automatic conversion of <code>AtString</code> to <code>char*</code>, but in some situations, such as when the returned <code>AtString</code> is used by <code>AiMsg*()</code> or <code>printf</code> type variadic functions, preexisting code will not compile.  In this case, the resulting <code>AtString</code> should have <code>.c_str()</code> called on it. (#5177)
</li><li>Added <code>AiMsgAddCallback()</code> to install an additional message handling callback alongside the default message processing. (#5736) 
</li><li>Removed functions of the form <code>fooAtString(AtString str)</code> in favor of the overloaded <code>foo(AtString str)</code> forms.  For instance, <code>AiNodeAtString(const AtString name)</code> is now <code>AiNode(const AtString name)</code> (#5177)
</li><li>Removed <code>AiLicense{Set|Get}Attempts()</code> and <code>AiLicense{Set|Get}AttemptDelay()</code>. (#2893)
</li><li><code>AiMakeRay()</code> and other shader utilities now return their result. (#5300)
</li><li>Changes to support hierarchical namespaces:
<ul><li><code>AiNode</code>: It now receives, in addition to the node entry name, the node name, and the parent (or NULL for a root node).
</li><li><code>AiNodeLookUpByName</code>: It receives a pointer to the parent node, so it can start relative search in the appropriate context (not necessary for absolute paths).
</li><li><code>AiNodeClone</code>: Since it creates a new node, it will now receive, like the AiNode function, the node name and (optionally) the parent node.
</li></ul></li><li>Removed <code>AtProcInitBounds</code>/<code>procedural_init_bounds</code> method from the procedural API, since procedurals no longer have user provided bounds (they are always open during initialization). (#5612)
</li></ul><h3 id="Arrays">Arrays</h3>
<ul><li><code>AtArray</code> is now opaque: Any operation involving <code>AtArray</code> objects has to be done through its new API, and not accessing its struct members which are now hidden. (#4082)
</li><li><code>AiArrayAllocate()</code> does not initialize memory: When an <code>AtArray</code> is created with <code>AiArrayAllocate()</code>, its contents are no longer initialized to zero and are instead left uninitialized. This results in slightly faster code. (#4507)
</li><li><code>AiArrayResize()</code> was added, to resize an <code>AtArray</code> in place, preserving its existing data. (#2073)
</li><li>Removed <code>AiArrayModify()</code>. (#5279)
</li></ul><h3 id="Colors">Colors</h3>
<ul><li>Removed <code>AiRGBCreate()</code> and <code>AiColor()</code>, replacing them with actual C++ constructors. For instance, <code>AtRGBA c = AiRGBACreate(1,0,1,0);</code> can now be written as <code>AtRGBA c(1,0,1,0);</code>. (#2158, #5271)
</li><li>Removed <code>AtColor</code>: <code>AtColor</code> has been deprecated in favor of <code>AtRGB</code>.  It is now in ai_deprecated.h. (#5352)
</li><li>Removed <code>AiColorLerp()</code> and <code>AiRGBALerp()</code> since the preexisting <code>AiLerp()</code> already did the same thing. (#5141)
</li><li>Removed <code>AiColorReset()</code> and <code>AiRGBAReset()</code> since it's simpler to just assign AI_RGB_BLACK and AI_RGBA_ZERO. (#5279)
</li><li>Removed <code>AiColorIsZero</code>, replace with the equivalent <code>AiColorIsSmall</code>. To see if a color is exactly zero use <code>== AI_RGB_BLACK</code>. (#5305)
</li><li>Removed <code>AiColorEqual()</code> in favor of the cleaner <code>operator==</code> and <code>!=</code> methods. (#5279)
</li><li>Removed <code>AiColorGamma()</code> and <code>AiRGBAGamma()</code>. (#5267)
</li><li>Renamed <code>AI_RGBA_BLACK</code> to <code>AI_RGBA_ZERO</code>, to clarify that its alpha component is zero. (#3928)
</li></ul><h3 id="Math">Math</h3>
<ul><li>Removed <code>AI_TYPE_POINT</code>: we no longer differentiate between points and vectors and so have removed <code>AI_TYPE_POINT</code> and all functions that operated on points when a similar vector function was available. For instance, instead of using <code>AiNodeSetPnt()</code>, you can directly use <code>AiNodeSetVec()</code>.  Search and replace of &quot;Pnt&quot; with &quot;Vec&quot; and &quot;POINT&quot; with &quot;VECTOR&quot; will go most of the way towards updating the code. <code>AtPoint</code> and <code>AtPoint2</code> have been deprecated and moved into ai_deprecated.h. (#5059)
</li><li>Removed <code>AiM4Berp()</code>, <code>AiColorBiLerp()</code>, <code>AiRGBAbiLerp()</code>, <code>AiColorHerp()</code>, <code>AiRGBAHerp()</code>, <code>AiColorBiHerp()</code>, <code>AiRGBAbiHerp()</code> and <code>BIHERP()</code>. (#4646)
</li><li>Removed <code>AiVector()</code> and replaced them with actual C++ constructors. (#2158, #5271)
</li><li>Renamed <code>MIN()</code>, <code>MIN3()</code>, <code>MIN4()</code>, and corresponding <code>MAX</code> to <code>AiMin()</code> and <code>AiMax()</code>, which are overloaded and support 2, 3, or 4 arguments. (#5232)
</li><li>Renamed <code>SQR</code> to <code>AiSqr</code> , <code>CLAMP</code> to <code>AiClamp</code>, <code>LERP</code> to <code>AiLerp</code> and <code>ACOS</code> to <code>AiSafeAcos</code>. (#5595)
</li><li><code>AtBBox</code>: The <code>AtBBox</code> related functions are now class member functions, so instead of writing something like: <code>AiBBoxIsEmpty(bbox)</code>, we do: <code>bbox.isEmpty()</code> (#5446)
</li><li><code>AtMatrix</code>: in the Python API, matrix elements are now accessed using the more natural <code>matrix[i][j]</code> syntax. (#5242)
</li><li>NaN/inf checking: We used to have three different names for NaN/inf checking of floats, colors and 3D vectors: <code>IsFinite</code>, <code>Corrupted</code>, and <code>Exists</code>. We have now consolidated all of those functions with a consistent name and meaning, following the float version. Therefore, <code>AiV3Exists()</code> has been renamed to <code>AiV3IsFinite()</code>, and <code>AiRGB/ACorrupted()</code> have been renamed to <code>AiRGB/AIsFinite()</code>, which reversed their meaning. (#2145)
</li><li><code>AiBuildLocalFrameShirley()</code> has been replaced by <code>AiV3BuildLocalFrame()</code>, which is faster and has fewer discontinuities. (#3213)
</li><li><code>AtSampler</code>: <code>AiSamplerSeeded()</code> has been renamed to <code>AiSampler()</code>, so that we now always require a random seed. The sampler now also supports 1D, 2D and 3D sample patterns, instead of only 2D. (#5451)
</li><li><code>AtVector</code> and <code>AtRGB/A</code> comparison operators: <code>AtVector</code>, <code>AtVector2</code>, <code>AtRGB</code>, and <code>AtRGBA</code> now have support for the <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, and <code>&gt;=</code> operators. After doing a comparison, calling <code>AiAny()</code> on the result will return a bool if any of the element comparisons were true and <code>AiAll()</code> will return true if all the element comparisons were true.  For instance, <code>AiAll(AtVector(1,2,3) &lt; AtVector(0,10,20))</code> will return false since the first element comparison <code>1 &lt; 0</code> is false. <code>AiAny(AtVector(1,2,3) &lt; AtVector(1,10,20))</code> on the other hand returns true. (#2157)
</li><li><code>AiFastPow()</code> added: this fast power function is suitable for cases where speed is more important than accuracy. (#5573)
</li><li>Removed <code>AiV3RayPoint()</code>.  You now need to do the math yourself, so <code>AiV3RayPoint(out, origin, dir, t)</code> becomes <code>out = origin + dir * t</code>. (#5089)
</li></ul><h3 id="BSDFs">BSDFs</h3>
<ul><li>The BSDF API has been completely revamped to support more advanced and optimized BSDFs, and to be usable for more advanced rendering algorithms. More detailed information is available in the <a class="ext-link" href="https://support.solidangle.com/display/ARP/BSDFs"><span class="icon">​</span>BSDF documentation</a>. (#4783)
</li><li><code>AiBSDFIntegrate()</code> can integrate both direct and indirect light. If only one or the other is needed, passing <code>NULL</code> for the unneeded component will skip it. If both are needed it is fastest to compute them in a single function call. (#5423)
</li><li><code>AiOrenNayarBSDF()</code>, <code>AiMicrofacetBSDF()</code>, <code>AiMicrofacetRefractionBSDF()</code> and <code>AiMetalBSDF()</code> are the built-in BSDFs. <code>AiOrenNayarIntegrate()</code>, <code>AiMicrofacetBTDFIntegrate()</code>, <code>AiDirectDiffuse()</code> and <code>AiIndirectDiffuse()</code> have been removed. (#4783, #5631)
</li><li><code>AiDielectricFresnel()</code> and <code>AiConductorFresnel()</code> have been added. (#5631)
</li><li>Renamed <code>AiFresnelWeight()</code> to <code>AiSchlickFresnel()</code>. (#5631)
</li><li>Removed Cook-Torrance, stretched Phong, Ashikhmin-Shirley and Ward BRDFS: use Microfacet BRDF instead. (#5161)
</li><li>Removed <code>AiHairDirectDiffuseCache()</code> and <code>hair</code> shader <code>diffuse_cache</code> parameter, use diffuse lighting without cache. (#5161)
</li></ul><h3 id="SSS">SSS</h3>
<ul><li>Removed <code>AiBSSRDFCubic()</code> and <code>AiBSSRDFGaussian()</code>. <code>AiBSSRDFEmpirical()</code> may be used instead. The cubic radius multiplied by 0.13 approximately matches the mean free path for the empirical BSSRDF. (#5161)
</li><li>Removed <code>AiSSSTraceSingleScatter()</code>. The empirical BSSRDF that includes an approximation for single scattering may be used instead, or for brute force volume scattering volume closures may be passed to the <code>interior</code> parameter of <code>AiClosureTransparent()</code> or <code>AiMicrofacetRefractionBSDF()</code>. (#5161)
</li><li>Removed <code>AiSSSEvaluateIrradiance()</code>, use raytraced SSS instead. (#4796)
</li></ul><h3 id="Volumes">Volumes</h3>
<ul><li>Removed <code>AiShaderGlobalsSetVolume*</code>. Instead volume closures must be used instead, which have the advantage of making volume shaders mixable. (#5503).
</li><li>Removed <code>sg-&gt;Vo</code> and <code>sg-&gt;Ci</code>. Instead <code>AiClosureVolumeAtmosphere()</code> must be used instead. (#4793)
</li><li>Renamed <code>volume_scattering</code> node to <code>atmosphere_volume</code> to clarify its purpose. (#5495)
</li><li>Removed <code>volume</code> shape node with <code>dso</code> parameter. Plugins will instead register custom node types now, for example <code>volume_openvdb</code>. (#5154)
</li><li>Volume plugins all now have a <code>bounds_slack</code> parameter.  The plugins are responsible to read that parameter and apply it to the bounds they report in the <code>AtVolumeData</code> struct. (#5831)
</li></ul><h3 id="Lights1">Lights</h3>
<ul><li><code>AiBSDFIntegrate()</code> can be used to integrate both direct and indirect light. If more low level access is needed, it is still possible to manually implement light loops and multiple importance sampling using the light sampling API. See the documentation for an <a class="ext-link" href="https://support.solidangle.com/display/ARP/Light+Loops"><span class="icon">​</span>example of custom direct light integration</a>. However it is strongly suggested to use closures and leave the light sampling to Arnold instead, to benefit from sampling optimizations and support light path expressions. (#5423)
</li><li><code>AiLightsGetSample()</code> now returns an <code>AtLightSample</code> with all light sample data, rather than writing it to shader globals. For light filters the <code>AtLightSample</code> in <code>sg-&gt;light_filter</code> can be used to read and modify the current light sample. (#5423)
</li><li><code>AiLightsTrace()</code> and <code>AiLightsTraceRayTypes()</code> have been added for low level direct light integration. (#5423)
</li><li>Removed <code>AiEvaluateLightSample()</code>. (#5423)
</li><li>Removed <code>AiLightGetAffectDiffuse()</code> and <code>AiLightGetAffectSpecular()</code>. <code>AiLightGetDiffuse()</code> and <code>AiLightGetSpecular()</code> now automatically return zero for when <code>light.affect_diffuse</code> or <code>light.affect_specular</code> are off. A new AiLightGetInfluence()` utility function can also be used instead of these functions, returning the right influence depending on the shading context and ray type. (#5423)
</li><li><code>AiLightsIntegrateShadowMatte()</code> was added to compute more useful shadow mattes. The new matte has color information if needed, correctly weights light occlusion when multiple lights are present and takes into account the surface's BSDF. (#5496)
</li><li>Removed <code>AiLightsGetShadowMatte()</code>, use <code>AiLightsIntegrateShadowMatte()</code> instead. (#5496)
</li></ul><h3 id="Plugins">Plugins</h3>
<ul><li>Procedural and volume plugins now work more similar to other plugins such as shaders, drivers and cameras. They are automatically loaded from paths passed to <code>AiLoadPlugins()</code>, <code>ARNOLD_PLUGIN_PATH</code> and <code>options.plugin_searchpath</code>, registering new node types and defining parameters when they are loaded. The available methods are the same, but the syntax has changed, for details see this <a class="ext-link" href="https://support.solidangle.com/display/ARP/Random+Flake+Procedural"><span class="icon">​</span>procedural API example</a>. (#5154)
</li><li>Derived types and type-names of the newly introduced node-like implicit, procedural and volume shape nodes are now exposed through corresponding <code>AtNodeEntry</code> functions in the API (#5686)
</li><li>Optional <code>node_plugin_initialize</code> and <code>node_plugin_cleanup</code> methods have been added. These methods can be used for initializing a plugin, if there is some initialization or data to be shared between nodes of the same type. These methods are only called if a node of this type is created. <code>AiNodeGetPluginData()</code> can be used to retrieve the plugin data created in <code>node_plugin_initialize</code>. (#5154)
</li><li><code>node_initialize</code> and <code>node_update</code> no longer provide a <code>params</code> parameter, and <code>AiNodeGetParams()</code> has been removed too. <code>AiNodeGet*/Set*</code> and <code>AiShaderEvalParam*</code> must now be used to access parameters. For best performance these parameters should be read and stored with <code>AiNodeGetLocalData()</code> in <code>node_update</code>, and then retrieved though <code>AiNodeGetLocalData()</code> in performance critical methods such as shader evaluation and pixel filtering. (#3796, #4853, #5145)
</li><li>Removed deprecated parameter creation functions with uppercase types <code>AiParameterENUM()</code> etc; use the lowercase versions instead, e.g. <code>AiParameterEnum()</code>. (#5182)
</li><li><code>AiMetadataSet???</code>: these API functions now operate on a node entry, for symmetry with the <code>AiMetaDataGet???</code> functions. The prototype for <code>node_parameters</code> has been modified to receive a <code>AtNodeEntry* nentry</code> parameter. (#5292)
</li><li><code>AtParamValue</code> values are now accessed as a function instead of directly, so for instance, <code>param.RGB = my_color</code> is now <code>param.RGB() = my_color</code>. (#5194)
</li><li>Removed <code>AiCameraGetLocalData()</code>, <code>AiFilterGetLocalData()</code> and <code>AiDriverGetLocalData()</code>. Instead, <code>AiNodeSetLocalData()</code> and <code>AiNodeGetLocalData()</code> can be used now to attach custom data to camera, filter and driver nodes, the same as for shaders. (#5281)
</li><li>Removed <code>AiCameraDestroy</code>, <code>AiFilterDestroy</code> and <code>AiDriverDestroy</code>. They no longer need to be called for custom cameras, filters or drivers, as this de-initialization now happens automatically inside Arnold. (#5278)
</li><li>Removed <code>AtVolumePluginVtable.SampleDeprecated()</code>, use the <code>Sample()</code> method instead. (#4180)
</li><li>Removed <code>AiLoadPlugin()</code> since <code>AiLoadPlugins()</code> does the exact same thing. (#4646)
</li></ul><h3 id="ShaderGlobals">Shader Globals</h3>
<ul><li>Added <code>AiShaderGlobalsGetUniformID()</code>, for getting a unique per face, subdivision patch, curve or point ID. This uniform ID may for example be used for randomizing colors per hair curve. DCC app plugins can benefit from this by removing the &quot;curve_id&quot; user data export that is used by certain shaders, and instead using this function, which would reduce memory usage a bit. (#2436)
</li><li>Removed <code>AtShaderGlobals.out_opacity</code>. Use <code>AiClosureTransparent()</code> instead to create mixable shaders with transparency. (#4793)
</li><li>Removed <code>AtShaderGlobals.area</code>, use the <code>AiShaderGlobalsArea()</code> method instead. (#4180)
</li><li>Removed image space coordinates from <code>AtShaderGlobals</code>: the <code>sx</code> and <code>sy</code> fields in <code>AtShaderGlobals</code> have been replaced with subpixel camera sample coordinates <code>px</code> and <code>py</code>. If <code>sx</code> and <code>sy</code> are needed they can be computed using the following code. (#5278)
<div class="wiki-code"><div class="code"><pre><span class="k">const</span><span class="kt">float</span><span class="o">=</span><span class="o">-</span>  sgx  sgpx  <span class="mf">2.0f</span><span class="o">/</span><span class="p">(</span><span class="p">(),</span><span class="s">&quot;xres&quot;</span>
    sy     sgy  sgpy  <span class="mf">2.0f</span><span class="o">/</span><span class="p">(</span><span class="p">(),</span><span class="s">&quot;yres&quot;</span>
</pre></div></div></li><li><code>AtShaderGlobals.bu</code> for curve objects has changed to cover the entire width of the curve from 0 to 1. If UVs are specified through <code>curves.uvs</code>, they will affect the <code>u</code> and <code>v</code> texture coordinates. The parametric coordinates <code>bu</code> and <code>bv</code> always range from 0 to 1 along the width and length of the curve respectively. (#5212)
</li><li><code>AiShaderGlobalsGetVertexUVs()</code>: <code>uvset</code> parameter added, an empty <code>AtString()</code> returns the default UVs. (#5653)
</li><li><code>AiShaderGlobalsStochasticOpacity()</code> now applies <code>geo_opacity</code> for min pixel width, and should no longer be manually applied by shaders. Instead, calling <code>AiShaderGlobalsStochasticOpacity()</code> in the shader will handle the opacity correction required by <code>min_pixel_width</code>, and any manual application must be removed to avoid double opacity correction. (#5399)
</li><li>For any <code>opacity</code> or equivalent parameters in shaders, <code>AiShaderEvalParamOpacity()</code> should be used to evaluate it. This enables optimizations for rendering of transparent surfaces. Failing to call this function will result in very slow rendering of opacity-mapped cutouts such as tree leaves or other overlapping transparent surfaces. (#5357)
<div class="wiki-code"><div class="code"><pre><span class="k">const</span><span class="o">=</span><span class="p">(</span><span class="p">,</span><span class="p">(</span><span class="p">));</span><code>   AtRGB opacity  AiShaderGlobalsStochasticOpacitysg AiShaderEvalParamOpacityp_opacity
</code></pre></div></div></li></ul><h2 id="Bugfixes">Bug fixes</h2>
<h3 id="a5.0.0.0">5.0.0.0</h3>
<p>
</p><div><dl class="wiki compact"><dt style="font-weight: bold; float:left; padding-right:.5em">#3851</dt><dd style="color:red">unnormalized lights with zero radius should NOT be treated as normalized</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#3962</dt><dd style="color:red">Curved motion blur can result in large excursions</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#4108</dt><dd style="color:red">number of pixels stat is too high</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5166</dt><dd style="color:red">fast_opacity results in noise for low auto_transparency_depth</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5169</dt><dd style="color:red">change default bump2d height to 1.0 so it matches bump3d</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5181</dt><dd style="color:red">kick -info should print default values for matrix parameters too</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5189</dt><dd style="color:red">Fix assorted memory leaks</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5212</dt><dd style="color:red">Curve barycentric and uv coordinates inconsistency</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5289</dt><dd style="color:red">AiNodeClone increases instance overhead memory stats</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5297</dt><dd style="color:red">Include detailed reason for failure in append (checkpointing) errors</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5326</dt><dd style="color:red">Kick should support -o for raw drivers</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5367</dt><dd style="color:red">Subdivs: bad limit surface near vertices connected to both boundaries and creases</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5368</dt><dd style="color:red">Subdivs: creased vertices are not correctly handled for UVs or indexed user data</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5393</dt><dd style="color:red">Assert triggered when overriding multiple shader assignment with single shader</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5396</dt><dd style="color:red">Drivers with append ON should not touch completed files</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5402</dt><dd style="color:red">Deep driver: use smaller minimum alpha value for samples</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5420</dt><dd style="color:red">Remove incorrect texel offset from persp_camera.uv_remap</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5425</dt><dd style="color:red">Subdiv: adaptive mode should work with orthographic cameras</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5427</dt><dd style="color:red">Subdiv: adaptive mode not working with very small subdiv_adaptive_error</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5430</dt><dd style="color:red">Corrupted output for high resolution EXR with many AOVs in scanline mode</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5432</dt><dd style="color:red">Displacing meshes with high valence vertices (&gt; 256) can crash</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5448</dt><dd style="color:red">crash in AtNode::getUserDataMemoryUsage()</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5454</dt><dd style="color:red">AiIrradiance returns too much indirect light</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5457</dt><dd style="color:red">Mesh light not evaluating UDIMs properly</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5458</dt><dd style="color:red">Fix minor memory leaks</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5459</dt><dd style="color:red">Account correctly for mesh lights importance table shader calls</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5468</dt><dd style="color:red">Different binary outputs from same scene</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5478</dt><dd style="color:red">Slow render with infinite velocity values in OpenVDB grids</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5538</dt><dd style="color:red">Crashes when accessing the camera in free render mode</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5551</dt><dd style="color:red">Portals not working with unconnected skydome light color</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5562</dt><dd style="color:red">Skydome light outside portals should be blocked</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5577</dt><dd style="color:red">Race condition in procedural population</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5593</dt><dd style="color:red">crash in AiTextureAccess when texture_autotile is changed</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5643</dt><dd style="color:red">Array sanity check happens with partially filled array data</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5644</dt><dd style="color:red">Crash in procedural creating an object with more than 2 motion keys (5.0)</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5664</dt><dd style="color:red">Use GGX instead of Beckman for plastic/metal mode in the utility shader</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5703</dt><dd style="color:red">Missing nodes should report an error and abort the render</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5710</dt><dd style="color:red">Curve minimum pixel width not working for some camera positions</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5721</dt><dd style="color:red">face_visibility crash</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5730</dt><dd style="color:red">Crash using Arnold 5 in C4DtoA from thread other than main</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5733</dt><dd style="color:red">Watermarked deep file hangs render</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5768</dt><dd style="color:red">AiMakeTx should close file handles of input textures</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5773</dt><dd style="color:red">Volumes missing IPR update when changing min and max parameters</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5792</dt><dd style="color:red">AiMakeTx should output error messages</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5794</dt><dd style="color:red">Add d'Eon and Zinke hair BSDFs in API</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5815</dt><dd style="color:red">motion parameters should not be inherited</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5818</dt><dd style="color:red">Artifacts with refractive levelset implicits</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5827</dt><dd style="color:red">Automatic reloading of a procedural with lights doesn't work</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5836</dt><dd style="color:red">Blackbody: should match for all rendering color spaces</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5837</dt><dd style="color:red">Refractive dispersion: maximize match for all rendering color spaces</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5851</dt><dd style="color:red">Add residual terms to `standard_hair`</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5863</dt><dd style="color:red">Free mode: crash when logging is on</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5867</dt><dd style="color:red">UINT AOVs not correctly written out</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5871</dt><dd style="color:red">Only warn once for deprecated nodes</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5881</dt><dd style="color:red">Allow changing thread_priority in Windows</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5896</dt><dd style="color:red">AiTraceProbe not evaluating opacity</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#4955</dt><dd style="color:red">OpenEXR driver: only warn about long metadata names if they are actually written out to output file</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#5858</dt><dd style="color:red">IPR moving in kick doesn't work in flat scenes</dd><dt style="font-weight: bold; float:left; padding-right:.5em">#3928</dt><dd style="color:red">Rename AI_RGBA_BLACK to AI_RGBA_ZERO</dd></dl></div><p>
</p>
</div>

</div>

</div>